{% extends "trainings/base.html" %}
{% block title %}Kanban ‚Äî Objectifs ArgonOS{% endblock %}
{% block body_class %}no-scroll{% endblock %}

{% block content %}
<div style="
  position: fixed;
  top: 90px; left:0; right:0; bottom:0;
  padding:18px; box-sizing:border-box;
  overflow:hidden;
  color: rgba(255,255,255,0.92);
  background:
    radial-gradient(1200px 600px at 18% -10%, rgba(21,96,130,0.25), transparent 55%),
    radial-gradient(1000px 600px at 86% 10%, rgba(255,137,233,0.14), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)),
    #0B0F14;">
  <style>
    .wrap{height:100%; display:flex; flex-direction:column; min-height:0;}
    .top{display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom:12px;}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.05); font-weight:950; font-size:12px;}
    .tabbtn{border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.92);
      padding: 8px 12px; border-radius: 999px; font-weight: 950; font-size: 12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; gap:8px; white-space:nowrap;}
    .grid{display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:12px; min-height:0; height:100%;}
    .col{min-height:0; border-radius:18px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); overflow:hidden; display:flex; flex-direction:column;}
    .colhead{padding:12px 14px; border-bottom:1px solid rgba(255,255,255,0.08); display:flex; justify-content:space-between; align-items:center;}
    .list{padding:12px; overflow:auto; min-height:0; display:flex; flex-direction:column; gap:10px;}
    .card{border:1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.22); border-radius: 14px; padding: 10px;}
    .t{font-weight:950;}
    .m{opacity:.7; font-size:12px; margin-top:6px;}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    .actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
    .flash{border:1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.20); border-radius: 14px; padding: 10px 12px; margin-bottom: 12px; font-weight: 950; font-size: 12px;}
    .flash.success{ border-color: rgba(34,197,94,0.35); background: rgba(34,197,94,0.10); }
    .flash.error{ border-color: rgba(239,68,68,0.35); background: rgba(239,68,68,0.10); }
  </style>

  <div class="wrap">

    <div class="top">
      <div>
        <div style="font-weight:950; font-size:16px;">üß© Kanban ‚Äî Objectifs ArgonOS</div>
        <div style="opacity:.7; font-size:12px; margin-top:6px;">Objectifs ‚ÄúKanban‚Äù (actionable).</div>
      </div>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <form method="get" style="margin:0;">
          <select name="trainer" class="tabbtn" onchange="this.form.submit()">
            <option value="">Tous les formateurs</option>
            {% for t in trainers %}
              <option value="{{ t.id }}" {% if trainer_id|stringformat:"s" == t.id|stringformat:"s" %}selected{% endif %}>
                {{ t.first_name }} {{ t.last_name }}
              </option>
            {% endfor %}
          </select>
        </form>

        <a class="tabbtn" href="{% url 'trainings:team_argonos' %}?tab=1to1">‚Üê Retour √©quipe</a>
      </div>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="flash {{ message.tags|default:'info' }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <div class="grid">

      <!-- TODO -->
      <div class="col">
        <div class="colhead">
          <span class="pill">‚è≥ √Ä faire</span>
          <span class="pill">{{ todo|length }}</span>
        </div>
        <div class="list">
          {% for o in todo %}
            <div class="card">
              <div class="row">
                <div class="t">{{ o.title }}</div>
                <span class="pill">{{ o.trainer }}</span>
              </div>
              <div class="m">
                {% if o.due_date %}üìÖ √©ch√©ance {{ o.due_date|date:"d/m/Y" }} ‚Ä¢ {% endif %}
                semaine {{ o.meeting.week_start|date:"d/m/Y" }}
              </div>
              <div class="actions" style="margin-top:10px;">
                {% if o.status != "DONE" %}
                  <form method="post" action="{% url 'trainings:argonos_objective_set_status' o.id 'DONE' %}" style="margin:0;">
                    {% csrf_token %}
                    <input type="hidden" name="trainer_id" value="{{ trainer_id }}">
                    <button class="tabbtn" type="submit">‚úÖ Terminer</button>
                  </form>
                {% endif %}
                {% if o.status != "DOING" %}
                  <form method="post" action="{% url 'trainings:argonos_objective_set_status' o.id 'DOING' %}" style="margin:0;">
                    {% csrf_token %}
                    <input type="hidden" name="trainer_id" value="{{ trainer_id }}">
                    <button class="tabbtn" type="submit">üöß En cours</button>
                  </form>
                {% endif %}
              </div>
            </div>
          {% empty %}
            <div style="opacity:.7;">Rien ici.</div>
          {% endfor %}
        </div>
      </div>

      <!-- DOING -->
      <div class="col">
        <div class="colhead">
          <span class="pill">üöß En cours</span>
          <span class="pill">{{ doing|length }}</span>
        </div>
        <div class="list">
          {% for o in doing %}
            <div class="card">
              <div class="row">
                <div class="t">{{ o.title }}</div>
                <span class="pill">{{ o.trainer }}</span>
              </div>
              <div class="m">
                {% if o.due_date %}üìÖ √©ch√©ance {{ o.due_date|date:"d/m/Y" }} ‚Ä¢ {% endif %}
                semaine {{ o.meeting.week_start|date:"d/m/Y" }}
              </div>
              <div class="actions" style="margin-top:10px;">
                <form method="post" action="{% url 'trainings:argonos_objective_set_status' o.id 'TODO' %}" style="margin:0;">
                  {% csrf_token %}
                  <input type="hidden" name="trainer_id" value="{{ trainer_id }}">
                  <button class="tabbtn" type="submit">‚Ü©Ô∏è Revenir</button>
                </form>
                <form method="post" action="{% url 'trainings:argonos_objective_set_status' o.id 'DONE' %}" style="margin:0;">
                  {% csrf_token %}
                  <input type="hidden" name="trainer_id" value="{{ trainer_id }}">
                  <button class="tabbtn" type="submit">‚úÖ Terminer</button>
                </form>
              </div>
            </div>
          {% empty %}
            <div style="opacity:.7;">Rien ici.</div>
          {% endfor %}
        </div>
      </div>

      <!-- DONE -->
      <div class="col">
        <div class="colhead">
          <span class="pill">‚úÖ Termin√©</span>
          <span class="pill">{{ done|length }}</span>
        </div>
        <div class="list">
          {% for o in done %}
            <div class="card">
              <div class="row">
                <div class="t">{{ o.title }}</div>
                <span class="pill">{{ o.trainer }}</span>
              </div>
              <div class="m">
                {% if o.due_date %}üìÖ √©ch√©ance {{ o.due_date|date:"d/m/Y" }} ‚Ä¢ {% endif %}
                semaine {{ o.meeting.week_start|date:"d/m/Y" }}
              </div>
              <div class="actions" style="margin-top:10px;">
                <form method="post" action="{% url 'trainings:argonos_objective_set_status' o.id 'TODO' %}" style="margin:0;">
                  {% csrf_token %}
                  <input type="hidden" name="trainer_id" value="{{ trainer_id }}">
                  <button class="tabbtn" type="submit">‚Ü©Ô∏è Rouvrir</button>
                </form>
              </div>
            </div>
          {% empty %}
            <div style="opacity:.7;">Rien ici.</div>
          {% endfor %}
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}