{% extends "trainings/base.html" %}
{% block title %}Dashboard Manager ‚Äî ArgonOS{% endblock %}
{% block body_class %}no-scroll{% endblock %}

{% block content %}
<div style="
  position: fixed;
  top: 90px;
  left: 0; right: 0; bottom: 0;
  padding: 18px;
  box-sizing: border-box;
  overflow: auto;
  color: rgba(255,255,255,0.92);
  background:
    radial-gradient(1200px 600px at 18% -10%, rgba(21,96,130,0.25), transparent 55%),
    radial-gradient(1000px 600px at 86% 10%, rgba(255,137,233,0.14), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)),
    #0B0F14;
">

  <style>
    .wrap{ max-width: 1180px; margin: 0 auto; }
    .panel{
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border: 1px solid rgba(255,255,255,0.07);
      box-shadow: 0 18px 45px rgba(0,0,0,0.55);
      overflow:hidden;
      margin-bottom: 14px;
    }
    .head{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:center;
    }
    .title{ font-weight: 950; font-size: 16px; margin:0; }
    .sub{ opacity:.7; font-size: 12px; margin-top:6px; }

    .tabbtn{
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.92);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 12px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .tabbtn:hover{ filter: brightness(1.06); }

    .grid{
      padding: 14px 16px;
      display:grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 10px;
    }
    .kpi{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.20);
      border-radius: 16px;
      padding: 12px;
      min-height: 72px;
      transition: transform .15s ease, filter .15s ease;
    }
    .kpi-label{ opacity:.75; font-size: 12px; }
    .kpi-val{ font-weight: 950; font-size: 18px; margin-top:6px; }

    .kpi-link{ text-decoration:none; color:inherit; display:block; }
    .kpi-link:hover .kpi{ transform: translateY(-1px); filter: brightness(1.05); }

    .body{ padding: 14px 16px; }

    table{ width:100%; border-collapse: collapse; }
    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      text-align:left;
      font-size: 13px;
      vertical-align: middle;
    }
    th{ opacity:.75; font-weight: 950; font-size: 12px; }

    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding: 4px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      font-weight: 950; font-size: 12px;
      white-space:nowrap;
    }
    .pill.bad{ border-color: rgba(239,68,68,0.35); background: rgba(239,68,68,0.10); }
    .pill.warn{ border-color: rgba(245,158,11,0.35); background: rgba(245,158,11,0.10); }
    .pill.ok{ border-color: rgba(34,197,94,0.35); background: rgba(34,197,94,0.10); }

    @media (max-width: 1100px){ .grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    @media (max-width: 680px){ .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
  </style>

  <div class="wrap">

    <div class="panel">
      <div class="head">
        <div>
          <div class="title">üìä Dashboard Manager ‚Äî ArgonOS</div>
          <div class="sub">
            Aujourd‚Äôhui : {{ today|date:"d/m/Y" }} ‚Ä¢ √âch√©ances proches jusqu‚Äôau {{ soon_limit|date:"d/m/Y" }}
          </div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <a class="tabbtn" href="{% url 'trainings:team_argonos' %}?tab=1to1">‚Üê Retour √©quipe</a>
          <a class="tabbtn" href="/admin/argonteam/onetooneobjective/">üõ†Ô∏è Objectifs (admin)</a>
        </div>
      </div>

      <div class="grid">
        <div class="kpi">
          <div class="kpi-label">Objectifs (total)</div>
          <div class="kpi-val">{{ kpi_total }}</div>
        </div>

        <a class="kpi-link" href="?filter=open"><div class="kpi">
          <div class="kpi-label">Ouverts</div><div class="kpi-val">{{ kpi_open }}</div>
        </div></a>

        <a class="kpi-link" href="?filter=done"><div class="kpi">
          <div class="kpi-label">Termin√©s</div><div class="kpi-val">{{ kpi_done }}</div>
        </div></a>

        <a class="kpi-link" href="?filter=blocked"><div class="kpi">
          <div class="kpi-label">Bloqu√©s</div><div class="kpi-val">{{ kpi_blocked }}</div>
        </div></a>

        <a class="kpi-link" href="?filter=overdue"><div class="kpi">
          <div class="kpi-label">En retard</div><div class="kpi-val">{{ kpi_overdue }}</div>
        </div></a>

        <a class="kpi-link" href="?filter=due_soon"><div class="kpi">
          <div class="kpi-label">√Ä √©ch√©ance (‚â§ 7j)</div><div class="kpi-val">{{ kpi_due_soon }}</div>
        </div></a>
      </div>
    </div>

    <div class="panel">
      <div class="head">
        <div>
          <div class="title">üë• Par formateur</div>
          <div class="sub">Objectifs + progression modules (valid√©s / actifs).</div>
        </div>
      </div>

      <div class="body">
        <table>
          <thead>
            <tr>
              <th>Formateur</th>
              <th>Ouverts</th>
              <th>Bloqu√©s</th>
              <th>En retard</th>
              <th>‚â§ 7j</th>
              <th>Termin√©s</th>
              <th>Modules</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                <td style="font-weight:950;">{{ r.trainer.first_name }} {{ r.trainer.last_name }}</td>
                <td><span class="pill">{{ r.trainer.objectives_open }}</span></td>

                <td>
                  {% if r.trainer.objectives_blocked %}
                    <span class="pill warn">{{ r.trainer.objectives_blocked }}</span>
                  {% else %}<span class="pill">0</span>{% endif %}
                </td>

                <td>
                  {% if r.trainer.objectives_overdue %}
                    <span class="pill bad">{{ r.trainer.objectives_overdue }}</span>
                  {% else %}<span class="pill">0</span>{% endif %}
                </td>

                <td>
                  {% if r.trainer.objectives_due_soon %}
                    <span class="pill warn">{{ r.trainer.objectives_due_soon }}</span>
                  {% else %}<span class="pill">0</span>{% endif %}
                </td>

                <td><span class="pill ok">{{ r.trainer.objectives_done }}</span></td>

                <td>
                  {% if r.modules_total %}
                    <span class="pill">
                      {{ r.modules_validated }}/{{ r.modules_total }}{% if r.modules_ratio != None %} ‚Ä¢ {{ r.modules_ratio }}%{% endif %}
                    </span>
                  {% else %}<span class="pill">‚Äî</span>{% endif %}
                </td>

                <td style="text-align:right;">
                  <a class="tabbtn" href="{% url 'trainings:team_argonos' %}?trainer={{ r.trainer.id }}&tab=1to1">Ouvrir</a>
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="8" style="opacity:.7;">Aucun formateur ArgonOS.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
{% endblock %}