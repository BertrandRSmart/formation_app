{# templates/trainings/home.html #}
{% extends "trainings/base.html" %}

{% block title %}Accueil ‚Äî BSmart Application{% endblock %}
{% block body_class %}home-gradient no-scroll{% endblock %}

{% block extra_head %}
<style>
  :root{
    --text: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.65);

    --border: rgba(255,255,255,0.06);
    --shadow: 0 18px 45px rgba(0,0,0,0.55);
    --r2: 22px;

    /* accents */
    --a-blue: #3B82F6;    /* Formations */
    --a-orange:#F59E0B;   /* Delivery/Projects */
    --a-violet:#7C3AED;   /* Pilotage formateurs */
    --a-green:#10B981;    /* Financier */
    --a-indigo:#6366F1;   /* Admin / divers */
  }

  /* ===== MODE COCKPIT (pas de scroll page) ===== */
  html, body { height: 100%; margin: 0; }
  body { overflow: hidden !important; }
  main { height: 100%; }

  .dash{
    position: fixed;
    left: 0; right: 0;
    top: 0; bottom: 0;
    box-sizing: border-box;
    padding: 92px 18px 18px;      /* ‚úÖ ne colle pas la topbar */
    overflow: hidden;              /* ‚úÖ pas de scrollbar */
    color: var(--text);
    background: transparent;
  }

  .dash-grid{
    height: calc(100vh - 92px - 18px);
    min-width: 0;
    display:grid;
    gap: 12px;
    grid-template-columns: clamp(300px, 26vw, 360px) minmax(0, 1fr) clamp(300px, 26vw, 380px);
    align-items: stretch;
  }

  .panel{
    min-width: 0;
    min-height: 0;
    overflow: hidden;
    border-radius: var(--r2);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    display:flex;
    flex-direction:column;
  }

  .panel-header{
    flex: 0 0 auto;
    padding: 12px 12px;
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    gap: 12px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
  }

  .title{ margin:0; font-size: 18px; font-weight: 900; letter-spacing: -0.2px; }
  .small{ font-size: 13px; color: var(--muted); }

  .panel-header--big .title{
    font-size: 20px;
    font-weight: 950;
    letter-spacing: -0.3px;
  }

  /* =========================================================
     LEFT ‚Äî Weekly Command Center
     ========================================================= */
  .weekly{
    padding: 12px;
    display:flex;
    flex-direction:column;
    gap: 10px;
    flex: 1 1 auto;
    overflow: hidden;
  }

  .weekly-top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    padding-bottom: 0;
  }
  .weekly-top h3{ margin:0; font-size:15px; font-weight: 900; letter-spacing:-0.2px; }

  .date-chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 7px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.04);
    color: rgba(255,255,255,0.88);
    font-size: 12.5px;
    font-weight: 850;
  }
  .date-chip .dot{
    width:8px; height:8px; border-radius:999px;
    background: rgba(255,255,255,0.35);
    box-shadow: 0 0 0 3px rgba(255,255,255,0.06);
  }

  .week-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 7px 10px;
    border-radius: 999px;
    border: 1px solid rgba(59,130,246,0.22);
    background: rgba(59,130,246,0.10);
    color: rgba(255,255,255,0.90);
    font-size: 12.5px;
    font-weight: 900;
    letter-spacing: -0.1px;
  }

  .weekly-hdr{
    display: grid;
    grid-template-columns: 1fr auto;
    grid-template-areas:
      "t t"
      "d w";
    gap: 8px 10px;
    align-items: center;
  }
  .weekly-hdr__title{ grid-area: t; }
  .weekly-hdr__date{ grid-area: d; justify-self: start; }
  .weekly-hdr__week{ grid-area: w; justify-self: end; }
  .weekly-hdr__h1{
    font-size: 20px;
    font-weight: 950;
    letter-spacing: -0.3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .kpi-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .kpi{
    position: relative;
    overflow:hidden;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(0,0,0,0.18);
    padding: 12px;
    min-height: 92px;
    transition: transform .18s ease, background .18s ease, border-color .18s ease;
  }
  .kpi:hover{
    transform: translateY(-3px);
    background: rgba(255,255,255,0.05);
    border-color: rgba(255,255,255,0.14);
  }
  .kpi::before{
    content:"";
    position:absolute; left:0; top:0; bottom:0;
    width: 4px;
    background: var(--accent, rgba(255,255,255,0.12));
    opacity: .95;
  }
  .kpi::after{
    content:"";
    position:absolute;
    inset:-60px -60px auto auto;
    width: 180px;
    height: 180px;
    background: radial-gradient(circle at center, rgba(255,255,255,0.16), transparent 62%);
    opacity: 0.22;
    pointer-events:none;
  }

  .kpi .label{
    font-size: 10.5px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.70);
    font-weight: 800;
  }
  .kpi .value{
    margin-top: 8px;
    font-size: 30px;
    font-weight: 900;
    line-height: 1;
    letter-spacing: -0.5px;
  }
  .kpi .hint{
    margin-top: 8px;
    font-size: 12px;
    color: rgba(255,255,255,0.70);
  }
  .kpi .hint b{ color: rgba(255,255,255,0.88); font-weight: 850; }

  .kpi--blue{ --accent: var(--a-blue); }
  .kpi--violet{ --accent: var(--a-violet); }
  .kpi--orange{ --accent: var(--a-orange); }
  .kpi--green{ --accent: var(--a-green); }

  .spark{
    position:absolute;
    right: 10px;
    bottom: 10px;
    width: 110px;
    height: 24px;
    opacity: .22;
    pointer-events:none;
    background:
      linear-gradient(90deg, transparent 0 8px, rgba(255,255,255,0.10) 8px 9px, transparent 9px 18px) repeat-x;
    background-size: 18px 100%;
    border-radius: 10px;
    mask-image: linear-gradient(90deg, transparent, #000 18%, #000 82%, transparent);
  }

  /* =========================================================
     CENTER ‚Äî Business Control Hub
     ========================================================= */
  .hub{
    padding: 12px;
    flex: 1 1 auto;
    min-height: 0;
    display:flex;
    flex-direction:column;
    gap: 10px;
    justify-content: stretch;
    overflow: hidden;
  }

  .hub-section{
    border: 1px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.02);
    border-radius: 18px;
    overflow:hidden;

    flex: 1 1 0;
    display:flex;
    flex-direction:column;
    min-height: 0;
  }

  .hub-section--blue   { border-color: rgba(59,130,246,0.18); background: rgba(59,130,246,0.06); }
  .hub-section--orange { border-color: rgba(245,158,11,0.18); background: rgba(245,158,11,0.06); }
  .hub-section--violet { border-color: rgba(124,58,237,0.18); background: rgba(124,58,237,0.06); }
  .hub-section--green  { border-color: rgba(16,185,129,0.18); background: rgba(16,185,129,0.06); }

  .hub-head{
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    padding: 8px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  }

  /* ‚úÖ titres de sections plus gros */
  .hub-head h2{
    margin:0;
    font-size: 16px;           /* ‚úÖ augment√© */
    font-weight: 950;
    letter-spacing:-0.25px;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .hub-head .tag{
    font-size: 12px;
    color: rgba(255,255,255,0.65);
  }

  .hub-grid{
    padding: 8px;
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;

    flex: 1 1 auto;
    min-height: 0;
    align-content: start;
  }

  .hub-card{
    position: relative;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(0,0,0,0.18);
    overflow:hidden;
    min-height: 74px;
    padding: 10px;
    color: rgba(255,255,255,0.92);
    text-decoration:none;
    transition: transform .18s ease, background .18s ease, border-color .18s ease;
  }
  .hub-card:hover{
    transform: translateY(-3px);
    background: rgba(255,255,255,0.05);
    border-color: rgba(255,255,255,0.14);
  }
  .hub-card::before{
    content:"";
    position:absolute; left:0; top:0; bottom:0;
    width: 4px;
    background: var(--accent, rgba(255,255,255,0.12));
    opacity: .95;
  }
  .hub-card::after{
    content:"";
    position:absolute;
    inset: 0;
    background:
      radial-gradient(160px 160px at 85% 30%, rgba(255,255,255,0.10), transparent 60%),
      linear-gradient(135deg, rgba(255,255,255,0.06), transparent 55%);
    opacity: .55;
    pointer-events:none;
  }

  .hc-title{ font-weight: 900; font-size: 13px; margin:0 0 3px; letter-spacing:-0.2px; }
  .hc-sub{ opacity: 0.72; font-size: 11.5px; margin:0; line-height: 1.2; }

  .hub-card--blue{ --accent: var(--a-blue); }
  .hub-card--orange{ --accent: var(--a-orange); }
  .hub-card--violet{ --accent: var(--a-violet); }
  .hub-card--green{ --accent: var(--a-green); }
  .hub-card--indigo{ --accent: var(--a-indigo); }

  .hub-card--disabled{
    opacity:.55;
    cursor:not-allowed;
    pointer-events:none;
  }

  /* =========================================================
     RIGHT ‚Äî Alerts summary
     ========================================================= */
  .alerts-list{
    padding: 12px;
    display:flex;
    flex-direction:column;
    gap: 10px;
    flex: 1 1 auto;
    overflow: hidden;
  }

  .chip{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding: 12px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.18);
  }
  .badge{
    min-width: 30px;
    height: 24px;
    padding: 0 10px;
    border-radius: 999px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size: 13px;
    font-weight: 900;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
  }

  .alert-item{ border: 1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.22); border-radius: 16px; padding: 12px; margin-bottom: 10px; }
  .alert-item__top{ display:flex; justify-content:space-between; gap:10px; margin-bottom:10px; }
  .alert-item__name{ margin:0; font-size: 14px; font-weight: 900; }
  .meta{ display:flex; flex-wrap:wrap; gap:8px; font-size:13px; color: rgba(255,255,255,0.78); }
  .meta span{ border:1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.03); padding:7px 10px; border-radius:999px; }

  /* Responsive */
  @media (max-width: 1180px){
    body{ overflow:auto !important; }
    .dash{ position: static; overflow: visible; height:auto; padding: 86px 14px 14px; }
    .dash-grid{ height:auto; grid-template-columns: 1fr; }
    .hub-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width: 820px){
    .hub-grid{ grid-template-columns: 1fr; }
  }

  /* ===== Ajustement des hauteurs de sections dans Business Control Hub ===== */

  /* 1) Chaque section prend une part, mais Pilotage formateurs prend plus */
  .hub-section{ flex: 1 1 0; }                 /* base */
  .hub-section--violet{ flex: 1.25 1 0; }      /* ‚úÖ pilotage formateurs plus grand */
  .hub-section--blue{ flex: 0.95 1 0; }        /* formations un peu plus compact */
  .hub-section--orange{ flex: 0.95 1 0; }      /* delivery un peu plus compact */
  .hub-section--green{ flex: 1.05 1 0; }       /* financier l√©g√®rement plus grand */

  /* 2) La grille ne doit pas ‚Äútasser‚Äù en hauteur */
  .hub-grid{
    align-content: stretch;     /* ‚úÖ remplit verticalement mieux */
  }

  /* 3) Petites s√©curit√©s pour que le bloc violet respire */
  .hub-section--violet .hub-grid{
    row-gap: 10px;
  }
</style>
{% endblock %}

{% block content %}
<div class="dash">
  <div class="dash-grid">

    <!-- LEFT -->
    <aside class="panel">
      <div class="panel-header weekly-hdr">
        <div class="weekly-hdr__title">
          <div class="title weekly-hdr__h1">Weekly Command Center</div>
          <div class="small">Synth√®se op√©rationnelle</div>
        </div>
     

        <div class="week-badge weekly-hdr__week" title="Semaine ISO">
          Focus ‚Ä¢ {{ today|date:"W" }}·µâ semaine
        </div>
      </div>

      <div class="weekly">
        <div class="weekly-top">
          <h3>KPIs</h3>
        </div>

        <div class="kpi-grid">
          <div class="kpi kpi--blue">
            <div class="label">ArgonOS</div>
            <div class="value">{{ week_argonos_count|default:"‚Äî" }}</div>
            <div class="hint"><b>Formations</b> pr√©vues</div>
            <div class="spark"></div>
          </div>

          <div class="kpi kpi--violet">
            <div class="label">Mercure</div>
            <div class="value">{{ week_mercure_count|default:"‚Äî" }}</div>
            <div class="hint"><b>Sessions</b> pr√©vues</div>
            <div class="spark"></div>
          </div>

          <div class="kpi kpi--orange">
            <div class="label">Deadlines</div>
            <div class="value">{{ week_deadlines_count|default:"‚Äî" }}</div>
            <div class="hint">√âch√©ance <b>cette semaine</b></div>
            <div class="spark"></div>
          </div>

          <div class="kpi kpi--green">
            <div class="label">Utilization</div>
            <div class="value">{% if week_utilization_pct %}{{ week_utilization_pct }}%{% else %}‚Äî{% endif %}</div>
            <div class="hint">Cible <b>{{ utilization_target|default:"80" }}%</b></div>
            <div class="spark"></div>
          </div>
        </div>
      </div>
    </aside>

    <!-- CENTER -->
    <section class="panel">
      <div class="panel-header panel-header--big">
        <div>
          <div class="title">Business Control Hub</div>
          <div class="small">Navigation rapide par th√®me</div>
        </div>
        <div class="small">Design unifi√©</div>
      </div>

      <div class="hub">

        <!-- FORMATIONS -->
        <div class="hub-section hub-section--blue">
          <div class="hub-head">
            <h2>üìö Formations</h2>
            <div class="tag">Planifier ‚Ä¢ suivre ‚Ä¢ g√©rer</div>
          </div>
          <div class="hub-grid">
            <a class="hub-card hub-card--blue" href="/admin/trainings/session/add/">
              <div class="hc-title">Cr√©er une session</div>
              <p class="hc-sub">Planifier une nouvelle session.</p>
            </a>

            <a class="hub-card hub-card--blue" href="{% url 'trainings:training_manage_home' %}">
              <div class="hc-title">Gestion des sessions</div>
              <p class="hc-sub">Filtres, participants, export.</p>
            </a>

            <a class="hub-card hub-card--blue" href="/agenda/">
              <div class="hc-title">Agenda</div>
              <p class="hc-sub">Vision calendrier des sessions.</p>
            </a>
          </div>
        </div>

        <!-- DELIVERY / PROJETS (Gestion des √©quipes retir√© d'ici) -->
        <div class="hub-section hub-section--orange">
          <div class="hub-head">
            <h2>üóÇ Delivery & Projects</h2>
            <div class="tag">organiser ‚Ä¢ prioriser ‚Ä¢ livrer</div>
          </div>
          <div class="hub-grid">
            <a class="hub-card hub-card--orange" href="{% url 'projects:projects_kanban' %}">
              <div class="hc-title">Kanban projets</div>
              <p class="hc-sub">Suivre planning, avancement, priorit√©s.</p>
            </a>

            <a class="hub-card hub-card--orange" href="{% url 'projects:projects_home' %}">
              <div class="hc-title">Kanban t√¢ches</div>
              <p class="hc-sub">TODO ‚Üí En cours ‚Üí Termin√©.</p>
            </a>

            <a class="hub-card hub-card--orange" href="/admin/">
              <div class="hc-title">Administration</div>
              <p class="hc-sub">Acc√®s admin (gestion avanc√©e).</p>
            </a>
          </div>
        </div>

        <!-- PILOTAGE FORMATEURS (Satisfaction sessions supprim√© + Gestion des √©quipes d√©plac√© ici en violet) -->
        {% if request.user.is_staff %}
          <div class="hub-section hub-section--violet">
            <div class="hub-head">
              <h2>üë• Pilotage formateurs</h2>
              <div class="tag">zone interne</div>
            </div>
            <div class="hub-grid">
              <a class="hub-card hub-card--violet" href="{% url 'trainer_eval:dashboard' %}">
                <div class="hc-title">Dashboard formateurs</div>
                <p class="hc-sub">Classement, score, niveaux.</p>
              </a>

              <a class="hub-card hub-card--violet" href="{% url 'trainer_eval:internal_eval_list' %}">
                <div class="hc-title">√âvaluations internes</div>
                <p class="hc-sub">Global + par formation.</p>
              </a>

              <a class="hub-card hub-card--violet" href="{% url 'trainer_eval:contributions_list' %}">
                <div class="hc-title">Contributions</div>
                <p class="hc-sub">Contenus, mentorat, projets.</p>
              </a>

              <a class="hub-card hub-card--violet" href="/team/?product=ARGONOS">
                <div class="hc-title">Gestion des √©quipes</div>
                <p class="hc-sub">Mercure / ArgonOS (onglets).</p>
              </a>
            </div>
          </div>
        {% endif %}

        <!-- PILOTAGE FINANCIER -->
        {% if request.user.is_staff or can_access_mercure %}
          <div class="hub-section hub-section--green">
            <div class="hub-head">
              <h2>üí∞ Pilotage financier</h2>
              <div class="tag">zone interne</div>
            </div>
            <div class="hub-grid">
              <a class="hub-card hub-card--green" href="{% url 'trainings:dashboard_ca' %}">
                <div class="hc-title">Dashboard chiffre d‚Äôaffaires</div>
                <p class="hc-sub">CA mois / trimestre, ArgonOS vs Mercure.</p>
              </a>

              {% if can_access_mercure %}
                <a class="hub-card hub-card--green" href="{% url 'trainings:dashboard_mercure_paiements' %}">
                  <div class="hc-title">Paiements Mercure</div>
                  <p class="hc-sub">Facturation, encaissement.</p>
                </a>
              {% else %}
                <div class="hub-card hub-card--green hub-card--disabled"
                     title="Acc√®s r√©serv√© aux formateurs Mercure et aux responsables">
                  <div class="hc-title">Paiements Mercure</div>
                  <p class="hc-sub">Acc√®s restreint.</p>
                </div>
              {% endif %}

              <a class="hub-card hub-card--green" href="/admin/">
                <div class="hc-title">Administration</div>
                <p class="hc-sub">Acc√®s admin (gestion avanc√©e).</p>
              </a>
            </div>
          </div>
        {% endif %}

      </div>
    </section>

    <!-- RIGHT -->
    <aside class="panel">
      <div class="panel-header panel-header--big">
        <div>
          <div class="title">Smart Alerts</div>
          <div class="small">Operational signals & risks</div>
        </div>
        <button class="xbtn" onclick="openDrawer('alertsDrawer')">Voir</button>
      </div>

      <div class="alerts-list">
        <div class="chip">
          <div>
            <strong>Convocations</strong>
            <div class="small">√Ä envoyer / √† traiter</div>
          </div>
          <span class="badge">{{ convocations_alerts_count }}</span>
        </div>

        <div class="chip">
          <div>
            <strong>Factures Mercure</strong>
            <div class="small">√âch√©ance ‚â§ 15 jours</div>
          </div>
          <span class="badge">{{ invoices_alerts_count }}</span>
        </div>

        <div style="padding:12px; border-radius:16px; border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02);">
          <div style="font-weight:900;">Astuce</div>
          <div class="small" style="margin-top:6px;">Clique sur ‚ÄúVoir‚Äù pour le d√©tail et fermer les alertes.</div>
        </div>
      </div>
    </aside>

  </div>
</div>

<!-- Drawer Alerts (inchang√©) -->
<div id="alertsDrawerBackdrop" class="drawer-backdrop" onclick="closeDrawer('alertsDrawer')"></div>

<div id="alertsDrawer" class="drawer" aria-hidden="true">
  <div class="drawer-top">
    <h2>üîî D√©tails des alertes</h2>
    <button class="xbtn" onclick="closeDrawer('alertsDrawer')">Fermer</button>
  </div>

  <div class="drawer-body">
    {% if convocations_alerts %}
      {% for s in convocations_alerts %}
        <div class="alert-item">
          <div class="alert-item__top">
            <h3 class="alert-item__name">
              {{ s.reference }}{% if s.training %} ‚Äî {{ s.training }}{% endif %}
            </h3>
          </div>

          <div class="meta">
            <span><strong>Client</strong> : {{ s.client }}</span>
            <span><strong>Formation</strong> : {{ s.training }}</span>
            <span>üìÖ {{ s.start_date|date:"d/m/Y" }} ‚Üí {{ s.end_date|date:"d/m/Y" }}</span>
          </div>

          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <a class="xbtn" style="text-decoration:none;" href="/admin/trainings/session/{{ s.id }}/change/">Ouvrir admin</a>
            <form method="post" action="{% url 'trainings:dismiss_convocation_alert' s.id %}" style="margin:0;">
              {% csrf_token %}
              <button class="xbtn" type="submit">Fermer l‚Äôalerte</button>
            </form>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="alert-item">
        <div style="font-weight:900;">Aucune alerte üéâ</div>
        <div class="small" style="margin-top:6px;">Rien √† envoyer aujourd‚Äôhui.</div>
      </div>
    {% endif %}

    <div style="margin-top:18px; font-weight:900;">üí≥ Factures Mercure (√©ch√©ance ‚â§ 15 jours)</div>

    {% if invoices_alerts %}
      {% for inv in invoices_alerts %}
        <div class="alert-item">
          <div class="alert-item__top">
            <h3 class="alert-item__name">
              {{ inv.reference|default:"Facture" }} ‚Äî {{ inv.trainer }}
            </h3>
          </div>

          <div class="meta">
            {% if inv.session %}
              <span><strong>Session</strong> : {{ inv.session.reference|default:"‚Äî" }} ‚Äî {{ inv.session.client }}</span>
              <span>üìÖ {{ inv.session.start_date|date:"d/m/Y" }}</span>
            {% endif %}
            <span><strong>Montant</strong> : {{ inv.amount_ht }} ‚Ç¨</span>
            <span><strong>√âch√©ance</strong> : {{ inv.due_date|date:"d/m/Y" }}</span>
          </div>

          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <a class="xbtn" style="text-decoration:none;" href="{% url 'trainings:mercure_invoice_detail' inv.id %}">Ouvrir d√©tail</a>
            <form method="post" action="{% url 'trainings:dismiss_mercure_invoice_alert' inv.id %}" style="margin:0;">
              {% csrf_token %}
              <button class="xbtn" type="submit">Fermer l‚Äôalerte</button>
            </form>

            {% if inv.document_path %}
              <a class="xbtn" style="text-decoration:none;" target="_blank" rel="noopener" href="{% url 'trainings:mercure_invoice_open' inv.id %}">üëÅÔ∏è Voir facture</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="alert-item">
        <div class="small" style="opacity:.8; margin-top:6px;">Aucune facture √† √©ch√©ance proche üéâ</div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}