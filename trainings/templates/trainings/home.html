{# templates/trainings/home.html #}
{% extends "trainings/base.html" %}

{% block title %}Accueil â€” BSmart Application{% endblock %}
{% block body_class %}home-gradient no-scroll{% endblock %}

{% block extra_head %}
<style>
  :root{
    --panel: rgba(255,255,255,0.05);
    --border-soft: rgba(255,255,255,0.07);
    --text: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.65);
    --shadow: 0 18px 45px rgba(0,0,0,0.55);
    --r: 18px;

    --c-team: #DCEFE3;
    --c-form: #156082;
    --c-proj: #FF89E9;
  }

  html, body{ height:100%; margin:0; }
  main{ height:100%; }

  .dash{
    position: fixed;
    inset: 0;
    box-sizing: border-box;
    padding: 92px 18px 18px;
    overflow: hidden;
    color: var(--text);

    /* âœ… on garde ton fond premium ici (il se mixe avec home-gradient) */
    background: transparent;
  }
      
  

  .dash-grid{
    flex: 1 1 auto;
    min-height: 0;
    min-width: 0;
    display:grid;
    gap: 16px;
    grid-template-columns: clamp(260px, 26vw, 320px) minmax(0, 1fr) clamp(280px, 26vw, 360px);
    align-items: stretch;
  }

  .panel{
    min-width: 0;
    min-height: 0;
    overflow: hidden;
    border-radius: var(--r);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid var(--border-soft);
    box-shadow: var(--shadow);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    display:flex;
    flex-direction:column;
  }

  .panel-header{
    flex: 0 0 auto;
    padding: 16px;
    display:flex;
    justify-content:space-between;
    gap: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
  }

  .title{ margin:0; font-size: 18px; font-weight: 950; }
  .small{ font-size: 13px; color: var(--muted); }

  .sidebar-stack, .actions, .alerts-list{
    min-height: 0;
    overflow: auto;
    scrollbar-width: thin;
  }

  .sidebar-stack{
    padding: 16px;
    display:flex;
    flex-direction:column;
    gap: 12px;
    flex: 1 1 auto;
  }

  .cat{
    position: relative;
    display:flex;
    gap:12px;
    align-items:flex-start;
    padding: 16px 16px 16px 18px;
    border-radius: 16px;
    background: rgba(0,0,0,0.18);
    border: 1px solid rgba(255,255,255,0.10);
    overflow: hidden;
    min-height: 140px;
  }
  .cat::before{
    content:"";
    position:absolute;
    left: 0; top: 0; bottom: 0;
    width: 10px;
    background: var(--catColor);
    border-top-left-radius: 16px;
    border-bottom-left-radius: 16px;
    opacity: 0.95;
  }
  .cat h3{ margin:0; font-size: 16px; font-weight: 950; }
  .cat ul{ margin:10px 0 0 0; padding:0; list-style:none; display:flex; flex-direction:column; gap:8px; }
  .cat a{ color: rgba(255,255,255,0.88); text-decoration:none; font-size: 14px; font-weight: 800; }
  .cat a:hover{ text-decoration: underline; }

  .hero{
    flex: 0 0 auto;
    padding: 18px;
    display:flex;
    justify-content:space-between;
    gap:12px;
  }
  .hero h1{ margin:0; font-size: 26px; font-weight: 950; }
  .hero p{ margin:8px 0 0 0; color: var(--muted); font-size: 15px; max-width: 60ch; }

  .pill{
    padding: 10px 14px;
    border-radius: 999px;
    border: 1px solid rgba(124,58,237,0.45);
    background: rgba(124,58,237,0.14);
    color: rgba(255,255,255,0.90);
    font-size: 14px;
    font-weight: 950;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap: 8px;
    white-space: nowrap;
    height: fit-content;
    cursor:pointer;
  }

  .actions{
    padding: 16px;
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 12px;
    align-content: start;
    flex: 1 1 auto;
  }

  .action{
    padding: 16px;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.18);
    color: var(--text);
    text-decoration:none;
    min-height: 110px;
    display:flex;
    flex-direction:column;
    gap: 10px;
    position: relative;
    overflow:hidden;
  }
  .action::before{
    content:"";
    position:absolute;
    left:0; top:0; bottom:0;
    width: 8px;
    background: var(--accent, rgba(255,255,255,0.12));
    opacity: .95;
  }
  .action strong{ font-size: 16px; font-weight: 950; }
  .action span{ font-size: 13px; color: rgba(255,255,255,0.70); }

  .action--ghost{
    visibility: hidden;
    pointer-events: none;
  }

  .alerts-list{
    padding: 16px;
    display:flex;
    flex-direction:column;
    gap: 12px;
    flex: 1 1 auto;
  }
  .chip{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding: 14px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.18);
  }
  .badge{
    min-width: 30px;
    height: 26px;
    padding: 0 10px;
    border-radius: 999px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size: 14px;
    font-weight: 950;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
  }

  .alert-item{ border: 1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.22); border-radius: 16px; padding: 12px; margin-bottom: 10px; }
  .alert-item__top{ display:flex; justify-content:space-between; gap:10px; margin-bottom:10px; }
  .alert-item__name{ margin:0; font-size: 14px; font-weight: 950; }
  .meta{ display:flex; flex-wrap:wrap; gap:8px; font-size:13px; color: rgba(255,255,255,0.78); }
  .meta span{ border:1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.03); padding:7px 10px; border-radius:999px; }

  @media (max-width: 1180px){ .dash-grid{ grid-template-columns: 1fr; } }
  @media (max-width: 820px){
    body{ overflow:auto; }
    .dash{ position: static; min-height:100vh; height:auto; }
    .actions{ grid-template-columns: 1fr 1fr; }
  }
  @media (max-width: 520px){
    .actions{ grid-template-columns: 1fr; }
  }
</style>
{% endblock %}

{% block content %}
<div class="dash">
  <div class="dash-grid">

    <!-- SIDEBAR -->
    <aside class="panel">
      <div class="panel-header">
        <div>
          <div class="title">Tableau de bord</div>
          <div class="small">Formations â€¢ Projets â€¢ Ã‰quipe</div>
        </div>
        <div class="small">Aujourdâ€™hui : {{ today|date:"d/m/Y" }}</div>
      </div>

      <div class="sidebar-stack">

        <div class="cat" style="--catColor: var(--c-form);">
          <div style="flex:1; min-width:0;">
            <h3>ðŸ“š Formations</h3>
            <ul>
              <li><a href="/admin/trainings/session/">Sessions</a></li>
              <li><a href="/admin/trainings/training/">Catalogue formations</a></li>
              <li><a href="/admin/trainings/participant/">Participants</a></li>
              <li><a href="/admin/trainings/session/add/">CrÃ©er une session</a></li>
              <li><a href="/agenda/">Agenda</a></li>
            </ul>
          </div>
        </div>

        <div class="cat" style="--catColor: var(--c-proj);">
          <div style="flex:1; min-width:0;">
            <h3>ðŸ§© Projets</h3>
            <ul>
              <li><a href="{% url 'projects:projects_home' %}">Kanban (tÃ¢ches)</a></li>
              <li><a href="{% url 'projects:projects_home' %}">Kanban (projets)</a></li>
            </ul>
          </div>
        </div>

        <div class="cat" style="--catColor: var(--c-team);">
          <div style="flex:1; min-width:0;">
            <h3>ðŸ‘¥ Ã‰quipe</h3>
            <ul>
              <li><a href="/admin/auth/user/">Utilisateurs</a></li>
              <li><a href="/admin/">Administration</a></li>
              <li><a href="/team/argonos/">Ã‰quipe ArgonOS</a></li>
            </ul>
          </div>
        </div>

      </div>
    </aside>

    <!-- MAIN -->
    <section class="panel">
      <div class="hero">
        <div>
          <h1>Accueil</h1>
          <p>Version stable + accÃ¨s rapide aux formations, au Kanban projets et Ã  lâ€™Ã©quipe.</p>
        </div>

        {% with c1=convocations_alerts|length %}
          <a class="pill" onclick="openDrawer('alertsDrawer')">
            ðŸ”” Alertes {% if c1 %}<span style="opacity:.9;">({{ c1 }})</span>{% endif %}
          </a>
        {% endwith %}
      </div>

      <div class="panel-header" style="border-top: 1px solid rgba(255,255,255,0.08);">
        <h2 class="title" style="margin:0;">âš¡ Actions rapides</h2>
        <div class="small">Gagne du temps</div>
      </div>

      <div class="actions">

        <!-- LIGNE 1 (FORMATIONS) -->
        <a class="action" href="/admin/trainings/session/add/" style="--accent: var(--c-form);">
          <strong>CrÃ©er une session</strong>
          <span>Planifier une nouvelle session.</span>
        </a>

        <a class="action" href="/admin/trainings/session/" style="--accent: var(--c-form);">
          <strong>GÃ©rer les sessions</strong>
          <span>Modifier dates, formateurs, statuts, participants.</span>
        </a>

        <a class="action" href="/agenda/" style="--accent: var(--c-form);">
          <strong>Agenda</strong>
          <span>Vision calendrier des sessions.</span>
        </a>

        <!-- LIGNE 2 (PROJETS) -->
        <a class="action" href="{% url 'projects:projects_kanban' %}" style="--accent: var(--c-proj);">
          <strong>Kanban (Gestion projets)</strong>
          <span>Suivre les projets : planning, avancement, prioritÃ©s.</span>
        </a>

        <a class="action" href="{% url 'projects:projects_home' %}" style="--accent: var(--c-proj);">
          <strong>Kanban (Gestion tÃ¢ches)</strong>
          <span>Organiser les tÃ¢ches : TODO â†’ En cours â†’ TerminÃ©.</span>
        </a>

        <div class="action action--ghost"></div>

        <!-- LIGNE 3 (Ã‰QUIPE) -->
        <a class="action action--full" href="/team/?product=ARGONOS" style="--accent: var(--c-team);">
          <strong>Gestion des Ã©quipes</strong>
          <span>AccÃ©der Ã  la gestion Mercure / ArgonOS (onglets).</span>
        </a>

      </div>
    </section>

    <!-- ALERTS SUMMARY -->
    <aside class="panel">
      <div class="panel-header">
        <div>
          <div class="title">ðŸ”” Alertes</div>
          <div class="small">RÃ©sumÃ©</div>
        </div>
        <button class="xbtn" onclick="openDrawer('alertsDrawer')">Voir</button>
      </div>

      <div class="alerts-list">
        <div class="chip">
          <div>
            <strong>Convocations</strong>
            <div class="small">Ã€ envoyer / Ã  traiter</div>
          </div>
          <span class="badge">{{ convocations_alerts|length }}</span>
        </div>
      </div>
    </aside>

  </div>
</div>

<!-- Drawer Alerts -->
<div id="alertsDrawerBackdrop" class="drawer-backdrop" onclick="closeDrawer('alertsDrawer')"></div>

<div id="alertsDrawer" class="drawer" aria-hidden="true">
  <div class="drawer-top">
    <h2>ðŸ”” DÃ©tails des alertes</h2>
    <button class="xbtn" onclick="closeDrawer('alertsDrawer')">Fermer</button>
  </div>

  <div class="drawer-body">
    {% if convocations_alerts %}
      {% for s in convocations_alerts %}
        <div class="alert-item">
          <div class="alert-item__top">
            <h3 class="alert-item__name">
              {{ s.reference }}{% if s.training %} â€” {{ s.training }}{% endif %}
            </h3>
          </div>

          <div class="meta">
            <span><strong>Client</strong> : {{ s.client }}</span>
            <span><strong>Formation</strong> : {{ s.training }}</span>
            <span>ðŸ“… {{ s.start_date|date:"d/m/Y" }} â†’ {{ s.end_date|date:"d/m/Y" }}</span>
          </div>

          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <a class="xbtn" style="text-decoration:none;" href="/admin/trainings/session/{{ s.id }}/change/">Ouvrir admin</a>

            <form method="post" action="{% url 'trainings:dismiss_convocation_alert' s.id %}" style="margin:0;">
              {% csrf_token %}
              <button class="xbtn" type="submit">Fermer lâ€™alerte</button>
            </form>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="alert-item">
        <div style="font-weight:950;">Aucune alerte ðŸŽ‰</div>
        <div class="small" style="margin-top:6px;">Rien Ã  envoyer aujourdâ€™hui.</div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}