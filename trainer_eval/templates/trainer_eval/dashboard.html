{% extends "trainings/base.html" %}
{% block title %}Dashboard formateurs{% endblock %}

{% block content %}
<div style="max-width:95vw; margin:0 auto; padding:18px 16px;">
  <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap;">
    <div>
      <h1 style="margin:0 0 6px;">Dashboard — Formateurs</h1>
      <div style="color:#64748b;">Données depuis le {{ year_start|date:"d/m/Y" }}. Visible staff uniquement.</div>
    </div>
  </div>

  <!-- ===================== BLOC SUPÉRIEUR : AUTRES ===================== -->
  <div style="margin-top:18px;">
    <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px; flex-wrap:wrap;">
      <h2 style="margin:0;">Formateurs ArgonOS / Autres <span style="opacity:.7; font-weight:500;">({{ other_rows|length }})</span></h2>
      <div style="color:#94a3b8; font-size:12px;">Tri : score décroissant</div>
    </div>

    <div style="margin-top:12px; overflow:auto; border:1px solid rgba(255,255,255,0.08); border-radius:12px;">
      <table style="width:100%; min-width:1200px; border-collapse:collapse;">
        <thead>
          <tr style="text-align:left; background:rgba(255,255,255,0.04);">
            <th style="padding:10px;">#</th>
            <th style="padding:10px;">Formateur</th>
            <th style="padding:10px;">Niveau</th>
            <th style="padding:10px;">Score</th>
            <th style="padding:10px;">Satisfaction</th>
            <th style="padding:10px;">Éval interne</th>
            <th style="padding:10px;">Contrib.</th>
            <th style="padding:10px;">Sessions</th>
            <th style="padding:10px;">Alertes</th>
          </tr>
        </thead>
        <tbody>
          {% for r in other_rows %}
            <tr style="border-top:1px solid rgba(255,255,255,0.06);">
              <td style="padding:10px; color:#94a3b8;">{{ forloop.counter }}</td>
              <td style="padding:10px;">{{ r.trainer }}</td>

              <td style="padding:10px;">
                <span style="padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06);">
                  {{ r.level }}
                </span>
              </td>

              <td style="padding:10px;">
                <div style="display:flex; align-items:center; gap:10px;">
                  <span style="min-width:48px; font-weight:800;">{{ r.score }}</span>
                  <div style="height:8px; width:140px; border-radius:999px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.10); overflow:hidden;">
                    <div style="height:100%; width: {{ r.score }}%; background:rgba(59,130,246,0.55);"></div>
                  </div>
                </div>
              </td>

              <td style="padding:10px;">{% if r.sat_avg %}{{ r.sat_avg }}/20{% else %}<span style="opacity:0.7;">—</span>{% endif %}</td>
              <td style="padding:10px;">{% if r.eval_avg %}{{ r.eval_avg }}/30{% else %}<span style="opacity:0.7;">—</span>{% endif %}</td>

              <td style="padding:10px;">
                <span style="padding:4px 8px; border-radius:999px; background:rgba(34,197,94,0.12); border:1px solid rgba(34,197,94,0.22);">
                  {{ r.points }}
                </span>
              </td>

              <td style="padding:10px;">{{ r.sessions_count }}</td>

              <td style="padding:10px;">
                {% if r.alerts_active > 0 %}
                  <span style="padding:4px 8px; border-radius:999px; background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.25);">
                    {{ r.alerts_active }}
                  </span>
                {% else %}
                  <span style="opacity:0.7;">0</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="9" style="padding:14px; color:#64748b;">Aucune donnée.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== BLOC INFÉRIEUR : MERCURE ===================== -->
  <div style="margin-top:26px;">
    <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px; flex-wrap:wrap;">
      <h2 style="margin:0;">Formateurs Mercure <span style="opacity:.7; font-weight:500;">({{ mercure_rows|length }})</span></h2>
      <div style="color:#94a3b8; font-size:12px;">Tri : score décroissant</div>
    </div>

    <div style="margin-top:12px; overflow:auto; border:1px solid rgba(255,255,255,0.08); border-radius:12px;">
      <table style="width:100%; min-width:1200px; border-collapse:collapse;">
        <thead>
          <tr style="text-align:left; background:rgba(255,255,255,0.04);">
            <th style="padding:10px;">#</th>
            <th style="padding:10px;">Formateur</th>
            <th style="padding:10px;">Niveau</th>
            <th style="padding:10px;">Score</th>
            <th style="padding:10px;">Satisfaction</th>
            <th style="padding:10px;">Éval interne</th>
            <th style="padding:10px;">Contrib.</th>
            <th style="padding:10px;">Sessions</th>
            <th style="padding:10px;">Alertes</th>
          </tr>
        </thead>
        <tbody>
          {% for r in mercure_rows %}
            <tr style="border-top:1px solid rgba(255,255,255,0.06);">
              <td style="padding:10px; color:#94a3b8;">{{ forloop.counter }}</td>
              <td style="padding:10px;">{{ r.trainer }}</td>

              <td style="padding:10px;">
                <span style="padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06);">
                  {{ r.level }}
                </span>
              </td>

              <td style="padding:10px;">
                <div style="display:flex; align-items:center; gap:10px;">
                  <span style="min-width:48px; font-weight:800;">{{ r.score }}</span>
                  <div style="height:8px; width:140px; border-radius:999px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.10); overflow:hidden;">
                    <div style="height:100%; width: {{ r.score }}%; background:rgba(99,102,241,0.55);"></div>
                  </div>
                </div>
              </td>

              <td style="padding:10px;">{% if r.sat_avg %}{{ r.sat_avg }}/20{% else %}<span style="opacity:0.7;">—</span>{% endif %}</td>
              <td style="padding:10px;">{% if r.eval_avg %}{{ r.eval_avg }}/30{% else %}<span style="opacity:0.7;">—</span>{% endif %}</td>

              <td style="padding:10px;">
                <span style="padding:4px 8px; border-radius:999px; background:rgba(34,197,94,0.12); border:1px solid rgba(34,197,94,0.22);">
                  {{ r.points }}
                </span>
              </td>

              <td style="padding:10px;">{{ r.sessions_count }}</td>

              <td style="padding:10px;">
                {% if r.alerts_active > 0 %}
                  <span style="padding:4px 8px; border-radius:999px; background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.25);">
                    {{ r.alerts_active }}
                  </span>
                {% else %}
                  <span style="opacity:0.7;">0</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="9" style="padding:14px; color:#64748b;">Aucune donnée Mercure.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}